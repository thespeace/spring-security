# 토큰으로 인증하기

## 세션(session)
이전에 세션에 대해서 알아본 적이 있다.  
![JWT](../../../images/15.JWT%201.PNG)
* 유저 A가 로그인을 하면 서버에서 유저 정보를 확인하고, 쿠키(JSESSIONID)를 응답.
* 유저 A의 앞으로의 요청들은 모두 쿠키(JSESSIONID)를 포함하여 요청.
* 서버는 요청에 포함된 쿠키를 확인하고, SecurityContext를 찾아서 인증.

<br>

## 세션의 장단점
### 장점
1. JESSIONID는 유의미한 값이 아니라 서버에서 세션(사용자) 정보를 찾는 Key로만 활용한다.  
   따라서 탈취되었다고 해서 개인정보가 탈취되진 않는다.  
   (세션하이제킹 공격을 당할 수 있기 때문에 절대적으로 안전하다는 뜻은 아니다.)

### 단점
1. 서버에 세션(사용자) 정보를 저장할 공간이 필요하다.  
   서비스를 이용하는 사용자가 많다면 저장할 공간도 더 많이 필요하다.
2. 분산 서버에서는 세션을 공유하는데 어려움이 있다.  
![JWT](../../../images/16.JWT%202.PNG)

이러한 단점으로 인해 사실상 토큰을 이용한 방식을 많이 사용한다.

<br>

## 토큰(Token)
세션의 단점을 해결하기 위해서 토큰으로 인증하는 방법을 사용할 수 있다.  
유저가 로그인을 하면 서버에서는 토큰을 생성한 뒤에 저장 하지 않고(stateless) 토큰 값을 내려준다.  
이 토큰 값을 유저가 게시글 조회 요청을 할 때 함께 보내고 서버2(서버1이여도 상관 없음)에서 이 토큰을 의미 있는 값으로 해석한다.  
그리고 그 값을 토대로 유저를 인증한다.  
세션방식에서의 JSESSIONID은 key로만 활용될 수 있는 의미없는 값이 들어 있다.  
그러나 토큰은 유저를 설명할 수 있는 데이터를 (ex)username) 포함 한다.
![JWT](../../../images/17.JWT%203.PNG)

<br>

## 토큰 방식의 장단점

### 장점
1. 세션관리를 할 필요가 없어 별도의 저장소가 필요하지 않다.
2. 서버 분산&클러스터 환경과 같은 확장성에 좋다.

### 단점
1. 한 번 제공된 토큰은 회수가 어렵다.  
   세션의 경우에는 서버에서 세션을 삭제해버리면 브라우저의 JSESSIONID는 무용지물이 되어버린다.  
   그러나 토큰은 세션을 저장하지 않기 때문에 한번 제공된 토큰을 회수할 수 없다.  
   그래서 보통 토큰의 유효기간을 짧게 한다.
2. 토큰에는 유저의 정보가 있기 때문에 상대적으로 안정성이 우려된다.  
   따라서 민감정보를 토큰에 포함시키면 안된다.(ex) 패스워드, 개인정보)
